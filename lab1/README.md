# Документация программной системы "Автоматизированный почтомат"

# Основные возможности:
- Отправка посылок через почтомат
- Получение посылок из почтомата
- Отправка уведомлений получателям
- Техническое обслуживание ячеек
- Мониторинг безопасности
- Статус почтомата
  
**Язык программирования:** Python 3.8+
  
**Стандарты кодирования:** PEP 8

**Типизация:** Полные аннотации типов
  
**Тестирование:** Модульное тестирование (unittest) с покрытием >85%
  
**Парадигмы:** ООП, процедурное программирование (CLI)
  
**Зависимости:** Только стандартная библиотека Python

----------
## Документация классов (Domain)

### `Postomat`
**Файл:** `postomat.py`

Класс представляет автоматизированный почтомат (постамат) для приема и выдачи почтовых отправлений. Управляет ячейками, посылками, уведомлениями и безопасностью.

**Как работает:** При создании почтомат инициализирует заданное количество ячеек с распределением по размерам (50% S, 30% M, 20% L). Через методы класса можно отправлять и получать посылки, отправлять уведомления, проводить техническое обслуживание и отслеживать безопасность.

*   **Атрибуты:**
    *   `id`: Уникальный идентификатор почтомата.
    *   `address`: Адрес установки почтомата.
    *   `total_lockers`: Общее количество ячеек.
    *   `security_level`: Уровень безопасности (LOW/MEDIUM/HIGH).
    *   `is_operational`: Флаг работоспособности (блокировки).
    *   `security_alerts`: Список событий безопасности.
    *   `user_operations`: Счетчик операций по пользователям.
    *   `lockers`: Список ячеек почтомата.
    *   `parcels`: Словарь посылок (ключ — трек-номер).
    *   `notifications`: История отправленных уведомлений.
    *   `maintenance_log`: Журнал технического обслуживания.

*   **Методы:**
    *   `send_parcel(parcel, user_id)`: Отправляет посылку через почтомат.
    *   `receive_parcel(tracking_number, recipient, user_id)`: Выдает посылку получателю.
    *   `notify_recipient(tracking_number, custom_message, user_id)`: Отправляет уведомление.
    *   `perform_maintenance(technician)`: Проводит техническое обслуживание.
    *   `get_statistics()`: Возвращает статистику работы почтомата.
    *   `__str__()`: Возвращает строковое представление почтомата.

---

### `Locker`
**Файл:** `postomat.py`

Класс представляет физическую ячейку почтомата для хранения посылок.

**Как работает:** Ячейка имеет определенный размер и может быть занята или свободна, исправна или неисправна. Посылка помещается в ячейку только если подходит по размеру и ячейка свободна.

*   **Атрибуты:**
    *   `number`: Номер ячейки (уникальный в пределах почтомата).
    *   `size`: Размер ячейки (S/M/L).
    *   `is_occupied`: Занята ли ячейка.
    *   `is_functional`: Исправна ли ячейка.
    *   `current_parcel`: Текущая посылка в ячейке.
    *   `last_maintenance`: Дата последнего обслуживания.

*   **Методы:**
    *   `open()`: Открывает ячейку (проверка исправности).
    *   `close()`: Закрывает ячейку.
    *   `put_parcel(parcel)`: Помещает посылку в ячейку.
    *   `take_parcel()`: Извлекает посылку из ячейки.
    *   `repair()`: Ремонтирует ячейку.
    *   `get_info()`: Возвращает информацию о ячейке в виде словаря.
    *   `__str__()`: Возвращает строковое представление ячейки.

---

### `Parcel`
**Файл:** `postomat.py`

Класс представляет почтовое отправление со всей необходимой информацией.

**Как работает:** При создании автоматически генерируется уникальный трек-номер. Посылка проходит через статусы: создана → в почтомате → получена (или просрочена). Срок хранения — 3 дня.

*   **Атрибуты:**
    *   `tracking_number`: Уникальный номер отслеживания (3 буквы + 10 цифр).
    *   `sender`: Отправитель посылки.
    *   `recipient`: Получатель посылки.
    *   `size`: Размер посылки (S/M/L).
    *   `description`: Описание содержимого (без цифр).
    *   `status`: Текущий статус посылки (создана, в почтомате, получена, просрочена).
    *   `created_at`: Дата и время создания.
    *   `placed_at`: Дата размещения в почтомате.
    *   `delivered_at`: Дата получения.
    *   `locker_number`: Номер ячейки в почтомате.
    *   `storage_days`: Срок хранения в днях (по умолчанию 3).
    *   `storage_until`: Дата окончания срока хранения.

*   **Методы:**
    *   `place_in_locker(locker_number)`: Размещает посылку в ячейке.
    *   `deliver()`: Отмечает посылку как полученную.
    *   `is_expired()`: Проверяет, истек ли срок хранения.
    *   `get_info()`: Возвращает информацию о посылке в виде словаря.
    *   `__str__()`: Возвращает строковое представление посылки.

---

### `Person` (Абстрактный базовый класс)
**Файл:** `postomat.py`

Базовый класс для отправителя и получателя.

**Как работает:** Содержит общие атрибуты для всех персон и генерирует уникальный идентификатор на основе данных. При создании проходит валидацию всех полей.

*   **Атрибуты:**
    *   `name`: Имя (только буквы, пробелы, дефис).
    *   `phone`: Телефон в формате +375XXXXXXXXX.
    *   `email`: Email в нижнем регистре.
    *   `id`: Уникальный идентификатор (первые 10 символов md5 хеша).

*   **Методы:**
    *   `__str__()`: Возвращает строковое представление персоны.

---

### `Sender`
**Файл:** `postomat.py`

Класс отправителя посылки, наследуемый от `Person`.

*   **Атрибуты:**
    *   `name`: Имя отправителя.
    *   `phone`: Телефон отправителя.
    *   `email`: Email отправителя.
    *   `address`: Физический адрес отправителя.
*   **Методы:**
    *   `__str__()`: Возвращает строковое представление отправителя.

---

### `Recipient`
**Файл:** `postomat.py`

Класс получателя посылки, наследуемый от `Person`.

*   **Атрибуты:**
    *   `name`: Имя получателя.
    *   `phone`: Телефон получателя.
    *   `email`: Email получателя.
*   **Методы:**
    *   `__str__()`: Возвращает строковое представление получателя.

---

### `Notification`
**Файл:** `postomat.py`

Класс представляет уведомление, отправляемое получателю посылки.

**Как работает:** Уведомление создается при отправке посылки или по запросу. При отправке имитируется задержка 0.1 секунды.

*   **Атрибуты:**
    *   `recipient`: Получатель уведомления.
    *   `parcel`: Связанная посылка.
    *   `message`: Текст сообщения.
    *   `type`: Тип уведомления (SMS/Email).
    *   `created_at`: Дата создания.
    *   `sent_at`: Дата отправки.
    *   `is_sent`: Флаг отправки.
    *   `attempts`: Количество попыток отправки.

*   **Методы:**
    *   `send()`: Отправляет уведомление (имитация).
    *   `__str__()`: Возвращает строковое представление уведомления.

---

### `Validator`
**Файл:** `postomat.py`

Статический класс для валидации всех входных данных в системе.

**Как работает:** Все методы класса являются статическими и могут вызываться без создания экземпляра. Обеспечивают единообразие проверок во всей системе.

*   **Атрибуты класса:**
    *   `BELARUSIAN_OPERATORS`: Допустимые коды операторов ["24", "25", "29", "33", "44"].

*   **Методы класса:**
    *   `validate_phone(phone)`: Проверяет формат белорусского телефона.
    *   `validate_email(email)`: Проверяет формат email.
    *   `validate_name(name)`: Проверяет имя (только буквы, пробелы, дефис).
    *   `validate_description(description)`: Проверяет описание (без цифр).
    *   `validate_address(address)`: Проверяет адрес (мин. 5 символов, не только цифры).
    *   `validate_tracking(tracking)`: Проверяет трек-номер (3 буквы + 5-15 цифр).
    *   `normalize_phone(phone)`: Приводит телефон к формату +375XXXXXXXXX.

---

### `ParcelStatus` (Enum)
**Файл:** `postomat.py`

Перечисление статусов посылки на всём жизненном цикле.

*   **Значения:**
    *   `CREATED = "создана"`: Посылка создана, но ещё не размещена в почтомате.
    *   `IN_POSTOMAT = "в почтомате"`: Посылка находится в ячейке почтомата.
    *   `DELIVERED = "получена"`: Посылка успешно получена получателем.
    *   `EXPIRED = "просрочена"`: Срок хранения посылки истёк.

---

### `ParcelSize` (Enum)
**Файл:** `postomat.py`

Перечисление размеров посылок и соответствующих ячеек.

*   **Значения:**
    *   `SMALL = "S"`: Маленький размер — занимает 50% всех ячеек.
    *   `MEDIUM = "M"`: Средний размер — занимает 30% всех ячеек.
    *   `LARGE = "L"`: Большой размер — занимает 20% всех ячеек.

---

### `SecurityLevel` (Enum)
**Файл:** `postomat.py`

Перечисление уровней безопасности почтомата.

*   **Значения:**
    *   `LOW = 1`: Низкий уровень — лимит 100 операций, нет автоблокировки.
    *   `MEDIUM = 2`: Средний уровень — лимит 50 операций, нет автоблокировки.
    *   `HIGH = 3`: Высокий уровень — лимит 50 операций, автоблокировка при серьёзных инцидентах.

---

### `NotificationType` (Enum)
**Файл:** `postomat.py`

Перечисление типов уведомлений для получателей.

*   **Значения:**
    *   `SMS = "SMS"`: Уведомление по SMS (на номер телефона).
    *   `EMAIL = "Email"`: Уведомление по электронной почте.

---

### `PostomatCLI`
**Файл:** `postomat.py`

Класс реализует интерфейс командной строки для взаимодействия с почтоматом.

**Как работает:** Создает текстовое меню, обрабатывает ввод пользователя с валидацией, вызывает соответствующие методы почтомата и отображает результаты.

*   **Атрибуты:**
    *   `postomat`: Экземпляр почтомата.
    *   `current_user_id`: ID текущего пользователя (генерируется автоматически).

*   **Методы:**
    *   `run()`: Запускает главный цикл программы.
    *   `print_header(text)`: Печатает заголовок с рамкой.
    *   `print_menu()`: Печатает главное меню.
    *   `input_with_validation(prompt, validator, error_message, required)`: Ввод с валидацией.

---

### `main()`
**Файл:** `postomat.py`

```bash
# Запуск программы
python postomat.py
```
# Логика работы системы "Автоматизированный почтомат"

## Общая схема работы
Запуск программы → Настройка почтомата → Главное меню → Выбор операции → Выполнение → Возврат в меню → Завершение
### Запуск программы
При запуске создается экземпляр класса `PostomatCLI`, который управляет пользовательским интерфейсом.

---

### Настройка почтомата
Пользователь вводит параметры почтомата:
- **ID почтомата** — уникальный идентификатор (например, PM001)
- **Адрес установки** — физический адрес размещения почтомата
- **Количество ячеек** — общее количество ячеек (распределение: 50% S, 30% M, 20% L)
- **Уровень безопасности** — LOW/MEDIUM/HIGH (влияет на лимиты операций и автоблокировку)

---

### Главное меню
После настройки отображается главное меню со всеми доступными операциями:

1.Отправить посылку

2.Получить посылку

3.Отправить уведомление

4.Техническое обслуживание

5.Безопасность

6.Статус почтомата

7.Сломать ячейку (тест)

8.Выход

---

### Обработка действий

#### Отправка посылки (пункт 1)
1. **Ввод данных отправителя:**
   - Имя (только буквы, пробелы, дефис)
   - Телефон (белорусский формат: +375XXYYYYYYY)
   - Email (стандартный формат)
   - Адрес (мин. 5 символов, не только цифры)

2. **Ввод данных получателя:**
   - Имя
   - Телефон
   - Email

3. **Выбор размера посылки:**
   - S — маленькая (помещается в любую ячейку)
   - M — средняя (только в M и L ячейки)
   - L — большая (только в L ячейки)

4. **Ввод описания (опционально):**
   - Не должно содержать цифр
   - Может быть пустым

5. **Обработка системой:**
   - Генерация уникального трек-номера (3 заглавные буквы + 10 цифр)
   - Поиск свободной ячейки подходящего размера
   - Размещение посылки в ячейке
   - Установка срока хранения (текущая дата + 3 дня)
   - Отправка уведомления получателю
   - Вывод информации о результате

---

#### Получение посылки (пункт 2)
1. **Ввод данных получателя:**
   - Имя
   - Телефон
   - Email

2. **Ввод трек-номера**

3. **Проверки системы:**
   - Проверка наличия посылки в почтомате
   - Проверка прав получателя (сравнение ID получателя)
   - Проверка срока хранения (не просрочена ли)

4. **Выдача посылки:**
   - Открытие ячейки
   - Извлечение посылки
   - Закрытие ячейки
   - Изменение статуса посылки на "получена"
   - Удаление посылки из активного списка

5. **Вывод информации о полученной посылке**

---

#### Отправка уведомления (пункт 3)
1. **Ввод трек-номера**

2. **Выбор шаблона сообщения:**
   - Стандартное напоминание
   - Посылка готова к выдаче
   - Своё сообщение (пользовательский ввод)

3. **Отправка уведомления:**
   - Создание объекта уведомления
   - Имитация отправки (задержка 0.1 сек)
   - Сохранение в историю уведомлений

4. **Вывод результата**

---

#### Техническое обслуживание (пункт 4)
1. **Отображение текущего состояния:**
   - Список неисправных ячеек (если есть)

2. **Ввод имени техника**

3. **Диагностика и ремонт:**
   - Проверка всех ячеек
   - Ремонт неисправных ячеек (85% вероятность успеха)
   - Обновление даты последнего обслуживания для исправных ячеек

4. **Вывод отчета:**

---

#### Безопасность (пункт 5)
1. **Просмотр статуса безопасности:**
- Уровень безопасности (LOW/MEDIUM/HIGH)
- Состояние (РАБОТАЕТ/ЗАБЛОКИРОВАН)
- Количество инцидентов
- Активные пользователи
- Последние инциденты

2. **Подменю безопасности:**
- **1. Просмотр всех инцидентов** — полный список событий безопасности
- **2. Сбросить безопасность** — очистка инцидентов и разблокировка (для администратора)
- **3. Назад** — возврат в главное меню

---

#### Статус почтомата (пункт 6)
**Отображение информации:**
- ID и адрес почтомата
- Текущий статус (работает/заблокирован)
- Уровень безопасности
- Статистика ячеек (всего/занято/свободно/исправно/неисправно)
- Количество активных посылок
- Список посылок с деталями:
- Трек-номер
- Имя получателя
- Номер ячейки
- Срок хранения
- Статус (в норме/просрочена)
- Состояние ячейки (исправна/неисправна)

---

#### Сломать ячейку (пункт 7) — тестовый режим
1. **Поиск случайной свободной исправной ячейки**

2. **Принудительная поломка:**
- Установка `is_functional = False`
- Логирование события в безопасность

3. **Вывод результата:**
- Сообщение о сломанной ячейке
- Используется для демонстрации работы техобслуживания

---

#### Завершение работы (пункт 0)
1. **Отображение статистики сессии:**
- Количество операций, выполненных текущим пользователем

2. **Завершение программы:**

----
# Модульное тестирование (Unit Tests)

**Файл:** `test_postomat.py`

## `TestExceptions`
Тестирование иерархии исключений. Проверяет корректность наследования всех исключений от базового класса `PostomatError` и передачу сообщений об ошибках.

---

## `TestEnums`
Тестирование всех перечислений (Enums). Проверяет корректность значений и количество элементов в `ParcelStatus`, `ParcelSize`, `SecurityLevel` и `NotificationType`.

---

## `TestValidatorFull`
Полное тестирование класса `Validator`. Проверяет валидацию телефонов (все форматы, коды операторов), email, имени, описания, адреса, трек-номера, а также нормализацию телефона.

---

## `TestPersonFull`
Тестирование классов `Person`, `Sender`, `Recipient`. Проверяет создание персон, нормализацию данных, генерацию ID, уникальность ID, ошибки валидации, создание отправителя с адресом и создание получателя.

---

## `TestParcelFull`
Тестирование класса `Parcel`. Проверяет создание посылки, генерацию уникальных трек-номеров, использование всех префиксов, уникальность номеров, размещение в ячейке, получение, проверку просрочки, получение информации и ошибки валидации.

---

## `TestLockerFull`
Тестирование класса `Locker`. Проверяет создание ячейки, открытие/закрытие, размещение посылки (подходящий размер, слишком большая, занятая, неисправная), извлечение посылки, извлечение из пустой, ремонт и получение информации.

---

## `TestNotificationFull`
Тестирование класса `Notification`. Проверяет создание уведомления с разными типами, успешную отправку, ошибку отправки, счетчик попыток и строковое представление.

---

## `TestPostomatFull`
Полное тестирование класса `Postomat`. Проверяет 5 основных операций:

**Операция 1: Отправка посылки** — успешная отправка, отправка при блокировке, дубликат, отсутствие ячеек, ошибка ячейки, системная ошибка.

**Операция 2: Получение посылки** — успешное получение, несуществующая, не тот получатель, блокировка, просрочка, неверный статус, ошибка ячейки.

**Операция 3: Уведомление** — успешная отправка, сообщение по умолчанию, несуществующая посылка, ошибка безопасности, ошибка уведомления.

**Операция 4: Техническое обслуживание** — обслуживание с неисправными, профилактика, отсутствие техника, неудачный ремонт, логирование, поломка ячейки.

**Операция 5: Безопасность** — базовая проверка, счетчик операций, подозрительная активность на LOW/HIGH, логирование, автоблокировка, статус безопасности, сброс.

**Дополнительные методы** — поиск ячейки, просроченные посылки, статистика.

---

## `TestIntegrationFull`
Интеграционные тесты. Проверяет полный жизненный цикл посылки, работу с несколькими посылками, цикл обслуживания (поломка → ремонт) и поток безопасности (нарушение → логирование → сброс).

---

## `TestCLIFull`
Ключевые тесты интерфейса командной строки. Проверяет инициализацию CLI, очистку экрана, печать заголовков, ввод с валидацией, настройку почтомата, ввод данных отправителя и получателя, завершение работы.

---

## `TestAdditionalCoverage`
Дополнительные тесты для повышения покрытия. Проверяет граничные случаи валидатора, разные уровни безопасности и поиск ячейки, когда все сломаны.

----

### Запуск тестов

```bash
coverage run -m unittest test_postomat.py
coverage report -m 
```
### Результаты тестирования
Все 123 теста проходят успешно

<img width="721" height="274" alt="image" src="https://github.com/user-attachments/assets/74cd0163-dc10-4ae2-923b-c105e33858d2" />




